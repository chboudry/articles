name: CI

on:
  push:
    branches: [ master ]

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  # This workflow contains a single job called "build"
  build:
    # The type of runner that the job will run on
    runs-on: ubuntu-latest

    # Steps represent a sequence of tasks that will be executed as part of the job
    steps:
      - name: Upload a Build Artifact
        uses: actions/upload-artifact@v2
        with:
          path: powershell-break.md
      - name: PowerShell script
        uses: Amadevus/pwsh-script@v1.0.0
        with:
          script: |
            Write-ActionDebug "This will be visible only when ACTIONS_STEP_DEBUG secret is set"
            $result = Invoke-WebRequest "https://test3164645.azurewebsites.net/api/HttpTrigger1?name=testparworkflow"
            
            Write-ActionDebug $result.Content
            
            $test = get-content './powershell-break.md'
            Write-ActionDebug $test

            # we have access to full context objects:
            if ($github.event.repository.full_name -ne $github.repository) {
              throw "something fishy's going on, repos don't match" # will cause step to fail
            }
            
            Write-ActionDebug $github.event.repository.full_name
            
            $someData = Get-MyCustomData
            # this data may contain action-command-like strings (e.g. '::warning::...')
            # we can prevent interpreting these by GitHub by printing them in NoCommandsBlock:
            Invoke-ActionNoCommandsBlock -GenerateToken {
              Write-Host $someData # this won't result in any commands
            }
            # now we can send commands again

            # let's set env:BE_AWESOME=always, but for all the following actions/steps as well:
            Set-ActionVariable BE_AWESOME always

            # also we'll add path to our custom tool to PATH for the following steps:
            $toolPath = Resolve-Path ./tools/bin
            Add-ActionPath $toolPath
            
            # let's also warn if it's too late for people to work in Greenwich ;)
            Write-ActionWarning "It's time to go to bed. Don't write code late at night! âš "
