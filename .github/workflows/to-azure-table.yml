name: CI

on:
  push:
    branches: [ master ]

jobs:
  build:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v2
      - name: test
        shell: powershell
        run: |
          $MarkdownFile= Get-Content ./powershell-break.md
          $MarkdownFile | Select-String '(?smi)^metadata.*?.+?' | %{($_ -split ":")[0]}
          $mdcontent = $MarkdownFile| Select-String '(?smi)^metadata.*?.+?' -notmatch | select-string '(?smi)^---' -notmatch
          Write-Output "The mdcontent is $mdcontent"
          
          $headers = New-Object "System.Collections.Generic.Dictionary[[String],[String]]"
          $headers.Add("Content-Type", "application/json")
          $headers.Add("Accept", "application/json;odata=fullmetadata")

          $body = @{
          "PartitionKey"="post"  
          "RowKey"="slugname"  
          "title"="nom long du post"  
          "description"="description"
          "dreateddate"="2008-07-10"  
          "updateddate"="2020-07-10"  
          "tag"="Azure"
          "author"="2020-07-10"
          "mdcontent"="md"
          } | convertto-Json

          $result = Invoke-WebRequest "https://test3164645.azurewebsites.net/api/HttpTrigger1?name=testparworkflow"
          Write-Output $result
          
          $response = Invoke-WebRequest AZURE_TABLE_URI -Headers $headers -Body $Body -Method 'POST'
          $response.rawcontent
